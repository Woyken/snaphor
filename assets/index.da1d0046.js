var t=Object.defineProperty,e=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,n=(e,a,r)=>a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[a]=r;import{t as i,e as s,s as o,r as l,j as c,d,a as u,u as h,C as p,A as m,b as f,G as g,m as y,c as v,f as w,g as x,h as b,T as I,i as O,B as S,P as C,F as E,k,l as T,n as D,o as $,R as M,p as A}from"./vendor.a7aa0e86.js";const F={r:0,g:51,b:187,a:255};function P(t,e,a){const r=e+a*t.width;return{r:t.data[4*r],g:t.data[4*r+1],b:t.data[4*r+2],a:t.data[4*r+3]}}function j(t,e){return Math.abs(t.r-e.r)<1&&Math.abs(t.g-e.g)<1&&Math.abs(t.b-e.b)<1&&Math.abs(t.a-e.a)<1}function N(t,e,a,r){let n=null;if(r.forEach((t=>{e>=t.x0&&e<=t.x1&&a>=t.y0&&a<=t.y1&&(n=t)})),n)return n;const i=function(t,e,a){const r=P(t,e,a);let n=a-1;for(;n>=0&&j(r,P(t,e,n));)n-=1;n+=1;let i=a+1;for(;i<t.height&&j(r,P(t,e,i));)i+=1;i-=1;let s=e-1;for(;s>=0&&j(r,P(t,s,a));)s-=1;s+=1;let o=e+1;for(;o<t.width&&j(r,P(t,o,a));)o+=1;return o-=1,{x0:s,x1:o,y0:n,y1:i}}(t,e,a);r.push(i)}function W(t,e,a,r,n){let i=r,s=0;for(;i>0;){i-=1;const r=P(t,i,n);if(s>1.5*e)break;j(a,r)?s=0:s+=1}return function(t,e,a,r){let n=r;for(;n>=0&&!j(e,P(t,a,n));)n-=1;n+=1;let i=a;for(;i>=0&&!j(e,P(t,i,n));)i-=1;i+=1;let s=r;for(;s<t.height&&!j(e,P(t,a,s));)s+=1;s-=1;let o=a;for(;o<t.width&&!j(e,P(t,o,s));)o+=1;return o-=1,{x0:i,x1:o,y0:n,y1:s}}(t,a,i,n)}async function z(t){i("finding events...");const e=function(t,e){const a=[];for(let r=0;r<e.height;r+=1)for(let n=0;n<e.width;n+=1)j(t,P(e,n,r))&&N(e,n,r,a);return a}(F,t).reduce(((t,e)=>{const a=t.find((t=>t.y0===e.y0));return a?(a.x0=Math.min(a.x0,e.x0),a.x1=Math.max(a.x1,e.x1),a.y1=Math.max(a.y1,e.y1)):t.push(e),t}),[]);i(`found ${e.length} events`);const a=e[0].x0-1;let r=e[0].y0;const n=P(t,a,r);for(r+=1;j(n,P(t,a,r));)r+=1;const l=function(t,e,a){const r=P(t,e,a);let n=e-1;for(;j(r,P(t,n,a));)n-=1;const i=P(t,n,a);let s=e+1;for(;j(r,P(t,s,a));)s+=1;return{width:s-n,borderColor:i}}(t,a,r),c=l.width,d=l.borderColor,u=W(t,c,d,a,r),h=new ImageData(u.x1-u.x0,u.y1-u.y0);for(let i=0;i<h.height;i+=1)for(let e=0;e<h.width;e+=1){const a=4*(h.width*i+e),r=4*(u.x0+e+(u.y0+i)*t.width);h.data[a]=t.data[r],h.data[a+1]=t.data[r+1],h.data[a+2]=t.data[r+2],h.data[a+3]=t.data[r+3]}i("Figuring out the dates...");const p=await async function(t){const e=s(t);return(await o.recognize(new File([e],"image.png"),"eng")).data.lines[0].text.replace(/\n$/g,"")}(h);i(`Found first date cell text "${p}"`);const m=p.match(/(\d\d\d\d)-?(\d\d)-?(\d\d)/);if(!m)throw i("Invalid date can't parse..."),new Error("Invalid date cell");const f=`${m[1]}-${m[2]}-${m[3]}`,g=new Date(f);i(`First date cell text as Date: "${g}"`);const y=u.y1-u.y0+1,v=e.map((t=>{const e=Math.floor((t.y0-u.y0)/y);return{startsAtTime:(t.x0-u.x1-3)/c,endsAtTime:(t.x1-u.x1-1)/c,daysOffsetFromFirst:e}})).map((t=>{const e=new Date(g);e.setDate(e.getDate()+t.daysOffsetFromFirst),e.setHours(Math.floor(t.startsAtTime)),e.setMinutes(t.startsAtTime%1*60);const a=new Date(e);return a.setHours(Math.floor(t.endsAtTime)),a.setMinutes(t.endsAtTime%1*60),{workStartTime:e,workEndTime:a}}));i("generating google calendar urls");const w=v.map((t=>{const e="Work",a="Automatically parsed from picture, hopefully dates are correct...",r=t.workStartTime,n=t.workEndTime;return{title:e,description:a,googleCreateEventUrl:function(t,e,a,r,n){return`https://calendar.google.com/calendar/u/0/r/eventedit?text=${a}&dates=${function(t,e){function a(t){return t.toISOString().replace(/-|:|\./g,"")}return`${a(t)}/${a(e)}`}(t,e)}${r?`&details=${r}`:""}${n?`&location=${n}`:""}`}(t.workStartTime,t.workEndTime,e,a),startDate:r,endDate:n}}));return i("Done parsing"),w}const H=l.exports.createContext({inputImage:void 0,isProcessing:!1,parsedEvents:[]}),U=t=>{const{children:e}=t,[a,r]=l.exports.useState(!1),[n,s]=l.exports.useState(),[o,u]=l.exports.useState([]);return l.exports.useEffect((()=>{const t=async t=>{var e,a;r(!0),s(void 0),u([]);const n=Array.from(null!=(a=null==(e=t.clipboardData)?void 0:e.files)?a:[]),o=n.filter((t=>"image/png"===t.type));if(n.length>o.length&&i.warn("Clipboard paste does not contain a .png image"),o.length<=0)return i.error("Clipboard paste does not contain a file"),void r(!1);o.length>1&&i("Pasted multiple files, how did you do that? picking only one...");const l=o[0],c=d(await l.arrayBuffer());s(new ImageData(new Uint8ClampedArray(c.data),c.width,c.height));const h=await z(c);u(h),r(!1)};return document.addEventListener("paste",t),()=>{document.removeEventListener("paste",t)}}),[]),c(H.Provider,{value:{isProcessing:a,inputImage:n,parsedEvents:o},children:e})};const{makeStyles:B,useStyles:L}=u.createMakeStyles({useTheme:function(){return((t,i)=>{for(var s in i||(i={}))a.call(i,s)&&n(t,s,i[s]);if(e)for(var s of e(i))r.call(i,s)&&n(t,s,i[s]);return t})({},h())}}),R=B()(((t,e,a)=>({resultsOverlay:{position:"absolute",top:0,left:0},previewCardWrapper:{display:"flex",alignItems:"center"},previewCard:{width:"10vw"},canvas:{width:"100%",maxWidth:"50vw"},cardTitle:{fontSize:14}}))),G=t=>{const{classes:e}=R(),a=l.exports.useContext(H),r=l.exports.useRef(null);return l.exports.useEffect((()=>{if(!r.current)return;const t=r.current.getContext("2d");t&&a.inputImage&&(r.current.height=a.inputImage.height,r.current.width=a.inputImage.width,t.putImageData(a.inputImage,0,0),r.current.scrollIntoView())}),[a,a.inputImage]),c("div",{className:e.resultsOverlay,children:c(p,{maxWidth:!1,children:c(m,{children:f(g,{container:!0,children:[a.inputImage?c(g,{item:!0,children:f(y.div,{className:e.previewCardWrapper,exit:{scale:0,transition:{ease:"backOut",duration:.4}},initial:{scale:0},animate:{scale:1,transformOrigin:"left top",transition:{ease:"backOut",duration:.4}},children:[c(p,{style:{zIndex:1},children:c(y.div,{whileHover:{scale:5,transition:{ease:"backOut",duration:.4}},animate:{transformOrigin:"left top"},children:c(v,{className:e.previewCard,children:c(w,{children:c("canvas",{className:e.canvas,ref:r})})})})}),c(x,{})]})}):null,c(g,{item:!0,children:c(p,{children:c(g,{container:!0,spacing:3,children:a.parsedEvents.map((t=>c(g,{item:!0,children:c(y.div,{exit:{scale:0,transition:{ease:"backOut",duration:.4}},initial:{scale:0},animate:{scale:1,transformOrigin:"left top",transition:{ease:"backOut",duration:.4}},children:f(v,{children:[f(b,{children:[c(I,{variant:"h5",component:"h2",children:t.title}),c(I,{variant:"body1",component:"p",children:t.description}),f(I,{variant:"body2",component:"p",children:["Start: ",t.startDate.toString()]}),f(I,{variant:"body2",component:"p",children:["End: ",t.endDate.toString()]})]}),c(O,{children:c(S,{size:"small",variant:"contained",color:"primary",href:t.googleCreateEventUrl,children:"Google calendar create this event"})})]})})},t.googleCreateEventUrl)))})})})]})})})})},V=B()((t=>({title:{fontSize:"10em"},wrapper:{height:"100vh",maxHeight:"100%",width:"100vw",maxWidth:"100%",display:"flex",alignItems:"center",justifyContent:"center"}}))),q=()=>{const{classes:t}=V();return c(C,{className:t.wrapper,children:c(I,{variant:"h1",className:t.title,children:"CTRL + V"})})},J=t=>(l.exports.useState(!1),f(E,{children:[c("div",{children:c(q,{})}),c(G,{})]}));const K=()=>{const t=k({palette:{mode:"light"}});return f(E,{children:[c(T,{}),c(D,{theme:t,children:f(U,{children:[c(J,{}),c($,{})]})})]})};M.render(c(A.StrictMode,{children:c(K,{})}),document.getElementById("root"));
